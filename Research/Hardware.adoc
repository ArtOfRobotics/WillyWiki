include::../Header.adoc[]

<<<<<<< HEAD
== Motor encoder


Willy is driven with 2 scooter motors. The turning of the wheels are
measured with wheel encoders. These encoders measure the number of steps
the motors have turned and send this data to the motor controller, which
processes this data.

image:media/current-status/image2.jpeg[image,width=163,height=96]

The need of the current motor encoders is optional. At the moment of
writing, the motor encoders aren’t working at all. The reason why these
motor encoders are chosen is to measure the distance and speed of the
motors. By combining this data with the sonars, willy will be able to
avoid obstacles inside. Because of the fact that these encoders aren’t
working we have to do some research to alternatives.

It is unknown why this controller is chosen. However previous
documentation does mention the exact model in use. (System overview
V1.0, 2017) (Systeem Dossier, 2016)

*Honywell Clarostat 600-128-CBL. Specs sheet*

[cols=",",options="header",]
|=======================================================================
|Product |Product
|600-128-CBL |600-128-CBL

|Encoder Type |Encoder Type

|Optical |Optical

|Pulse Per Revolution |128

|Output |2-square wave, Channel A leads Channel B by 90° electrically in
counterclockwise direction

|Output Voltage |2.4 Vdc min. (high); 0.4 Vdc max. (low)

|Operating Temperature |-40 °C to 65 °C [-40 °F to 149 °F]

|Storage Temperatue |-55 °C to 110 °C [-67 °F to 230 °F]

|Rotational Life |10 Million shaft rotations, min.

|Operating Speed |Operating Temperature

|Terminal |Cable with four-lead ribbon, 28 AWG, IL-W-168780 Type B or
equivalent insulation

|Source voltage range |5 Vdc ±5% at 30 mA max. plus external
requirements

|Supply Current |30 mA
|=======================================================================

image:media/current-status/image3.jpeg[image,width=155,height=116]Motor controller

Willy contains 2 motors from a second-hand mobility scooter. A previous project
group has chosen this option as documented in the ‘Ontwerp verslag’.
(Ontwerpverslag, 2016)

These motors need 24 volts and use 20 amps. One of the previous project
groups created the motor controller to control the motors. This is
documented in the ‘Systeem dossier’ from a previous project group.
(Systeem Dossier,
2016)image:media/current-status/image4.jpeg[image,width=112,height=149]

This motor controller is made by using an Arduino Mega and a custom
shield with additional custom hardware. This hardware makes sure the
data from the wheel encoders are sent to the proper digital pins on the
Arduino board. The motor controller processes the data and sends it to
the ROS framework. This data is then processed by the WillyController,
which is running as a node on the ROS framework.

The current to the motors is also controlled by this Arduino.

The motor controller is built as shown below:

image:media/current-status/image5.jpg[image,width=604,height=427]

[[_Toc508714671]]

=== Motor brake functionality

The two engines of willy contain both a brake. This brake is controlled
by the engine itself. When the active signal to the motors is lost, the
motor will automatically activate the brake. To start the driving_willy
project, you NEED to deploy the brakes. Otherwise Willy will not drive!

image:media/current-status/image6.jpeg[image,width=268,height=358]image:media/current-status/image7.png[image,width=269,height=359]

Make sure to deploy the brakes. Otherwise Willy won’t work!! There is
only one way to detect if the brakes are deployed. It’s by simply
testing if the wheel can turn (Or a very little bit) anymore.

=== Ultrasonic sensors

To prevent collisions, ultrasonic sensors are used. These sensors
measure distance by using sound. This is made possible by sending out
bursts of high frequency noise, and then waiting for a reflection of
that sound.image:media/current-status/image8.jpeg[image,width=208,height=117]

By using this data Willy is be able to decide if he is able to drive any
further in a certain direction. In the event of Willy being not able to
drive any further, he will decide if there is a direction where he is
able to drive further. This way Willy will be able to drive around
autonomously without collisions. How Willy reacts to objects in his
navigation is researched by a previous group. (Navigation design v0.1,
2017)

The sensors all use 5V as can be seen in the schematic:

image:media/current-status/image9.jpg[image,width=604,height=427](!!!OLD!!!)

As shown in the schematic above, all the 16 sensors are connected to the
Arduino.

The sensors are connected in the following order:

[cols=",",options="header",]
|===============================================
|Arduino Digital Pin Number |Sonar Sensor Number
|3 |Sensor 0
|4 |Sensor 1
|5 |Sensor 2
|6 |Sensor 3
|7 |Sensor 4
|8 |Sensor 5
|9 |Sensor 6
|10 |Sensor 7
|11 |Sensor 8
|12 |Sensor 9
|13 |Sensor 10
|A0 |Sensor 11
|A1 |Sensor 12
|A2 |Sensor 13
|A3 |Sensor 14
|A4 |Sensor 15
|===============================================

The sensors are placed as follows:

image:media/current-status/image10_3.jpg[image,width=339,height=476]

It should be noted that not all the sensor are read at the same time. 
All odd numbered sensors are read first, and after a small delay the 
even numbered sensors are read. This is because sensors placed next to
each other can interfere the readings of each other.

=== Kinect Sensor

image:media/current-status/image11.png[image,width=266,height=92]

As a method to navigate inside, the Kinect was chosen. A Kinect can
create a framework of a person and see all movements of that person. By
adding a Kinect to willy, willy will be able to recognize people and
interact with them by using the speech recognition of the Kinect.

There are two versions of the Microsoft Kinect: Kinect 1 for Xbox 360
and Kinect 2 for Xbox one. See table 1 which list all the different
features of both versions.

[cols=",,",options="header",]
|======================================================
|Feature |Kinect 1 |Kinect 2
|Color Camera |640 x 480 @30 fps |1920 x 1080 @30 fps
|Depth Camera |320 x 240 |512 x 424
|Max Depth Distance |~4.5 M |8 M
|Min Depth Distance |40 cm in near mode |50 cm
|Depth Horizontal Field of View |57 degrees |70 degrees
|Depth Vertical Field of View |43 degrees |60 degrees
|Tilt Motor |Yes |no
|Skeleton Joints Defined |20 joints |25 joints
|Full Skeletons Tracked |2 |6
|USB Standard |2.0 |3.0
|======================================================

The main difference which is most important for us is the Field of View
(FoV). The bigger the FoV, the more Willy can see in front of him. The
Kinect 2 can also recognize more people and can see further away, which
are both nice features to have when the social aspect of Willy will be
implemented in the future. This makes the Kinect 2 more futureproof than
its precursor. (Kinect 1 vs 2 specifications: , sd) (Kinect 1
specifications, sd) (Main factors/features of most industrial computer
vision hardware., sd)

=== GPS & Compass sensor

To allow Willy to drive outdoor by using a precomputed route, a GPS
sensor and a compass are required. The GPS sensor is linked to the
WillyController using ROS. In WillyController the raw data is processed
to usable coordinates. These coordinates are only used to draw a line
where Willy has driven in the code of the previous group. +
The Compass is used to determinate the direction of willy. This is
needed for navigation when willy is going to drive precomputed routes.

The sensors are connected according to the following scheme:

image:media/current-status/image12.jpg[image,width=604,height=427]

As can be seen in the scheme, there are two Arduino’s used to measure
sensor data. Both Arduino’s are connected with I2C (see pins A4 and A5).
The second Arduino with the GPS sensor is powered with the 5V pin from
the first Arduino. At the moment of writing this has not been fixed and
reduced to one Arduino.

=== LIDAR sensor

The previous group has also done research on a Lidar sensor.
Unfortunately the previous documentation stated that it was not possible
to link a Lidar to ROS. Also other methods where somehow researched by a
previous group but not in the form of a Lidar. (Research localization
system v1.1, 2017)

A LIDAR sensor uses a laser to measure distance. With these measurements
the sensor makes a map of all the objects in the environment.

image:media/current-status/image13.jpeg[image,width=130,height=174]The current state of
Willy has no LIDAR installed. The previous group has done some research
concerning LIDAR and the link to ROS. But came to the conclusion that it
is not possible to create a link between LIDAR and ROS. Therefore they
decided to not implement the LIDAR sensor.

After doing some research we found that it is possible and supported to
link ROS to a LIDAR sensor.

=== Avantages & Disadvantages

[cols=",,",options="header",]
|====================================================================
|Items |Advantages |Disadvantages
|Motor encoder a|
1.  Cheap

 a|
1.  Inaccurate
2.  Quality of brackets

|Motor controller a|
1.  One controller for all motor
2.  communications

 a|
1.  No clear overview

|Ultrasonic sensor a|
1.  Fast
2.  Accurate measuring of distance
3.  Cheap
4.  Wide range
5.  Easy to mount

 a|
1.  Temperature (does not work if temperature is around zero degrees)
2.  Control of big amounts of sensors will become complicated

|Kinect sensor a|
1.  Precision face cam
2.  Good microphone

 a|
1.  Little possibility to determine the position in the room
2.  Can be complicated to implement

|GPS & Compass sensor a|
1.  GPS is a good method for determining the outdoor position
2.  Compass is fast

 a|
1.  GPS is slow with finding satellites
2.  Data can be inaccurate

|LIDAR sensor a|
1.  Accurate way to scan the environment

 a|
1.  Can be complicated to implement

|Mini PC a|
1.  Central place to run ROS with Willy code and web platform

 a|
1.  Sensitive to malfunctions (e.g. overheating, moisture)

|====================================================================

[bibliography]
== References
- link: {url}/Documents/#_inventorisement_current_status
=======
== Hardware

=== Batteries

link:../Archive/2018S1/Research/batteries.html[Research Batteries]
>>>>>>> 5125deff4c185e8265885183fd9971de21e71236
